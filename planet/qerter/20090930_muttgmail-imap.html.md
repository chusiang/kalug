---
title: "使用Mutt收GMail IMAP電子郵件, Part 1 基礎設定篇"
date: 2009-09-30
type: blog
author: qerter
link: http://feedproxy.google.com/~r/qerter/~3/K8WHPKCTjeI/muttgmail-imap.html
layout: post
comments: true
---

為響應Richard Stallman 2008年9月在英國衛報反對使用者投入雲端運算的懷抱(<a href="http://www.guardian.co.uk/technology/2008/sep/29/cloud.computing.richard.stallman">Cloud computing is a trap, warns GNU founder Richard Stallman</a>)，我決定改變收電子郵件的習慣。我個人最依賴的雲端服務當為Google的GMail服務。而馬上離開不使用GMail不是件易事，我構思分階段實行降低對GMail依賴程度。<br /><br /><ul><li>第一階段：降低對GMail Web的依賴程度</li></ul>第一階段可以做的就是使用一般收信軟體，如evolution, 雷鳥與Mutt等相關軟體，將GMail信件利用POP3與IMAP收信協定，將電子郵件收到本機端閱讀，並且利用SMTP送信協定寄送電子郵件。<br /><br />我挑選<a href="http://www.cyut.edu.tw/%7Eckhung/a/c013.php">軟體耦合度最低</a>同時也十分輕巧的Mutt，來當我平時收發電子郵件的軟體。使用Mutt的好處是：<br /><ol><li>收信的工作交給fetchmail(支援POP3、IMAP等收信協定)<br /></li><li>寄信的工作交給msmtp(支援SMTP等寄信協定)</li><li>寫信的工作交給Vim(這個不用解釋了吧！)</li><li>通訊錄的工作可以交給Abook（但不支援vCard格式匯入）</li></ol>那Mutt要幹嘛？它幫我把收好的信件以thread/date的方式排序，方便閱讀與回信。fetchmail、msmtp與Mutt配合的設定，可參考<a href="http://qerter.wiki.ptt.cc/-Mutt+Fetchmail+Msmtp+GnuPG">這篇</a>的設定，在此不贅述。<br /><br />設定fetchmail之後就要開始把GMail的信收到電腦本機。我使用IMAPS協定。不收還好，一收就得收全部的信下來。我花了四個多小時才把我信箱裡面的八千多封信通通收下來=.=。不過GMail只會下載之前WebMail上的未讀信件。<br /><br />用Mutt收信一段時間以後，總覺得要看信之前才執行fetchmail太不經濟了，用Command Line就是要自動化才夠爽阿阿阿！<br /><br />參考<a href="http://tldp.org/LDP/Bash-Beginners-Guide/html/index.html">Bash Guide for Beginners</a>寫了一個bash script，執行fetchmail時計算新信件有幾封順便使用notify-send提醒。不過使用crontab去執行時，卻發生一點問題。參考這篇<a href="http://gnome-hacks.org/hacks.html?id=82">Notify from cronjob</a>，抄DBUS_SESSION_BUS_ADDRESS寫法，就ok了。將script命名為getmail.sh，使用crontab 30分鐘執行一次即可。<br /><br />Script如下給有需要的人參考：<br /><br /><code><br />#!/bin/bash<br /><br />########################################################################################<br /># This scripts is just using fetchmail command to get new mails and notify by notify-send <br /># command <br />#######################################################################################<br /><br />USER=`whoami`<br />PIDS=`pgrep -u $USER gnome-session`<br /><br /><br />#Get new mails and count them<br />NEW_MAILS_COUNT=$(fetchmail |grep -c octets)<br /><br />#Only show notified message when get new mails<br />if [ $NEW_MAILS_COUNT != 0 ]<br />then<br /><br />for pid in $PIDS; do<br /># find DBUS session bus for this session<br />DBUS_SESSION_BUS_ADDRESS=`grep -z DBUS_SESSION_BUS_ADDRESS \<br />/proc/$pid/environ | sed -e 's/DBUS_SESSION_BUS_ADDRESS=//'`<br /># use it<br />DBUS_SESSION_BUS_ADDRESS=$DBUS_SESSION_BUS_ADDRESS \<br />notify-send "新郵件提示" "$NEW_MAILS_COUNT 封新郵件"<br />done<br />fi<br /><br /></code><br /><br />這個Script還蠻簡陋的，目前僅能做到定時提醒而已，但是只要彈出那一瞬間有事離開電腦沒看見，就不知道了。未來希望能夠以Tray ICON形式在工具列，定期輪詢，有新信時彈出提醒訊息，並且變換圖示為新信件。